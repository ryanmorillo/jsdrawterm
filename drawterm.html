<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>drawterm</title>
<script src="config.js" type="text/javascript"></script>
<script src="config.local.js" type="text/javascript"></script>
<script>
window.addEventListener('error', function(e) {
	console.error('Global error:', e.message, e.filename, e.lineno, e.colno, e.error);
});
window.addEventListener('unhandledrejection', function(e) {
	console.error('Unhandled promise rejection:', e.reason);
});
var Module = {
	print: function(text) { console.log('WASM stdout:', text); },
	printErr: function(text) { console.error('WASM stderr:', text); },
	onAbort: function(what) { console.error('WASM aborted:', what); },
};

function showStaticError(msg) {
	var error = document.getElementById('error');
	if(!error) return;
	document.getElementById('thegrey').style.display = 'flex';
	document.getElementById('loading').style.display = 'none';
	document.getElementById('login').style.display = 'grid';
	error.style.display = 'block';
	error.style.whiteSpace = 'pre-wrap';
	error.textContent = msg;
}

function checkWasmMime() {
	fetch('blob.wasm', {method: 'HEAD'}).then(r => {
		var ct = r.headers.get('content-type') || '';
		if(ct.indexOf('application/wasm') === -1) {
			showStaticError([
				"blob.wasm is not served with Content-Type: application/wasm.",
				"",
				"Python's default http.server does not set this MIME type.",
				"Use a custom handler instead:",
				"",
				"  python - <<'PY'",
				"  import http.server, socketserver",
				"  class H(http.server.SimpleHTTPRequestHandler):",
				"      extensions_map = dict(http.server.SimpleHTTPRequestHandler.extensions_map)",
				"      extensions_map['.wasm'] = 'application/wasm'",
				"  socketserver.TCPServer(('', 8000), H).serve_forever()",
				"  PY",
			].join('\\n'));
		}
	}).catch(() => {});
}

document.addEventListener('DOMContentLoaded', checkWasmMime);
</script>
<script src="blob.js" type="text/javascript"></script>
<script></script>
<script src="aux.js" type="text/javascript"></script>
<script>
setTimeout(function() {
	if(typeof C === 'undefined') {
		console.error('WASM failed to initialize after 5 seconds!');
	}
}, 5000);
</script>
<script src="rcpu.js" type="text/javascript"></script>
<script src="tls.js" type="text/javascript"></script>
<script src="9p.js" type="text/javascript"></script>
<script src="devdraw.js" type="text/javascript"></script>
<script src="devcons.js" type="text/javascript"></script>
<script src="devaudio.js" type="text/javascript"></script>
<style type="text/css">
	html, body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
	canvas {
		margin: 0;
		display: none;
	}
	#thegrey {
		display: flex;
		justify-content: center;
		align-items: center;
		flex-direction: row;
		margin: 0;
		width: 100%;
		height: 100%;
		background: #777777;
	}
	* {
		font-size: 20pt;
		font-family: sans-serif;
	}
	#loading {
		border: 4px solid #55aaaa;
		background: white;
		padding: 1cm;
		display: flex;
		flex-direction: column;
	}
	#loading > div {
		margin-top: 1em;
		display: flex;
		flex-direction: row;
		justify-content: space-between;
	}
	#loading span { font-size: 24pt; }
	#login {
		border: 4px solid #55aaaa;
		background: white;
		padding: 1cm;
		display: none;
	}
	#login input {
		margin-top: 0.5em;
		margin-bottom: 0.5em;
	}
	#error {
		display: none;
	}
</style>
</head>
<body>
<div id="thegrey">
<div id="loading">
<img src="loading.jpg" alt="ROB">
<div><span>L</span><span>O</span><span>A</span><span>D</span><span>I</span><span>N</span><span>G</span></div>
</div>
<form id="login" onsubmit="go(); return false">
<span id="error"></span>
<input type="text" id="user" placeholder="User name">
<input type="password" id="password" placeholder="Password">
<input type="submit" value="Connect">
</form>
</div>
<canvas id='canvas' width="1024" height="768">
</canvas>
</body>
</html>
